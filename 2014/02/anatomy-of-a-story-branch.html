<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Anatomy of a Story Branch</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Ricardo Gladwell's Blog">
    <meta name="author" content="Ricardo Gladwell">
    <meta name="keywords" content="java,android,scala,maven,eclipse,git">
    <meta name="generator" content="JBake">

    <!-- Le styles -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/asciidoctor.css" rel="stylesheet">
    <link href="/css/base.css" rel="stylesheet">
    <link href="/css/bootstrap-theme.min.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="/js/html5shiv.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="favicon.ico">
  </head>
  <body>
    <div id="wrap">
	
    <!-- Fixed navbar -->
    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand" href="http://gladwell.me/">Ricardo Gladwell</a>
        </div><!-- /.navbar-header -->
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li><a href="/feed.xml">Subscribe</a></li>
          </ul>
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container-fluid -->
    </div><!-- /.navbar -->
    <div class="container">	
	<div class="page-header">
		<h1>Anatomy of a Story Branch</h1>
	</div>

	<p><em>16 February 2014</em></p>

	<p><p>I've been using git a lot for my open-source work and I've been trying to encourage its use in my professional work for a while now. What's interesting is the different ways people use the same tool.</p>

<p>The biggest variance is in the way people re-write their feature branch commit histories using git rebase -interactive or git merge --squash. Some people completely ignore this feature, preferring to capture a complete history of their commits as they happened, warts and all. Others squash all their changes into a single commit when they merge.</p>

<p>I prefer a middle-ground based on agile software practices, where I create a feature or story branch for each story with a single, squashed commit for the main feature functionality and smaller commits for associated changes (bug fixes, refactorings, etc.).</p>

<p>To do this, I use git's interactive rebase feature which allows you to go back through your branch's commit log and re-edit, merge, split re-order and even delete individual commits. Its an extremely useful and powerful tool.</p>

<p>So, lets start with a typical, messy story branch, as yet untouched by a rebase:</p>

<h2>Feature Commits</h2>

<p>Here we can see there are four feature commits: two adding (failing) tests for our new feature, and another two which adds implementing code and satisfies the unit tests, in good TDD fashion. Generally these four commits would be squashed together to make a single, feature commit with all the changes specific to the story acceptance criteria contained within.</p>
   
<h2>Refactor Commits</h2>

<p>Associated with these are a couple of re-factor commits: as part of the agile process, developers should re-factor code to make it simpler and more efficient as they add functionality.</p>

<p>And this is what happened here: in-between implementing my two feature commits I noticed an area of the code which could use re-factoring. Instead, I could have committed my work and branched off the master  to keep them completely separate but I think that approach could proliferate branches, and I still think re-factoring work is tangentially related to the core feature/story I'm working on.</p>

<p>However, I don't squash these commits along with the feature commits: I prefer to keep them to make it clear which changes are directly related to the feature I'm working on. Typically I re-order these commits so they appear last in the branch history.</p>

<h2>Bug Fix Commits</h2>

<p>Similarly, sometimes as I working on features I come across bugs in existing code which I fix. These bug fix commits are treated just like re-factor commits and left un-squashed in the branch.</p>

<h2>Local Fix Commits</h2>

<p>Sometimes as I'm coding a complex feature I'll implement several core commits before I realise I introduced a bug or two earlier. This leads to several local fix commits: since they don't fix bugs outside of the branch, I generally squash them along with the commits that introduced the bug (usually refactor or feature commits).</p>

<p>This has two nice features: firstly it simplifies the commit log, and secondly it means if people roll back to my feature commit they are guaranteed to get working code.</p>

<h2>Tidy Commits</h2>

<p>Finally, as I'm messing around with code I frequently spot formatting mistakes, compiler warnings and other niggling problems that I've missed. These tidy commits are typically treated like local fix commits and squashed with the feature or refactor commit that introduced them.</p>

<h2>Summary</h2>

<p>I find I get a nice balance with the above approach, ensuring I commit regularly (rather than waste time worrying too much about what is in each commit) while at the same time ensuring that I end up with a simpler and more legible commit log to merge into my master branch once the story is complete.</p>

<p>One last advantage of using the interactive rebase is that I can also review my commit messages. Normally these are rushed while I focus on getting my work done, so its nice to be given an opportunity to review and edit these to make them clearer and tidy up any spelling or grammatical mistakes.</p>
</p>

	<hr>
	
		</div>
		<div id="push"></div>
    </div>
    
    <div id="footer">
      <div class="container">
        <p class="muted credit">&copy; 2013, 2014 | Mixed with <a href="http://twitter.github.com/bootstrap/">Bootstrap v2.3.1</a> | Baked with <a href="http://jbake.org">JBake v2.2.1</a> | Decorated with Bootswatch <a href="http://bootswatch.com/cyborg/">Cyborg Theme v3.1.0+1</a></p>
      </div>
    </div>
    
    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/js/jquery-1.9.1.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/run_prettify.js"></script>
    
  </body>
</html>